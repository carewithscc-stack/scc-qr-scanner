<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SCC QR Scanner â€” Final</title>
<style>
  body{font-family:Arial; padding:20px; background:#f0f2f5;}
  .card{max-width:420px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.15);}
  h1{text-align:center;}
  select, button{padding:10px;margin:5px;border-radius:8px;}
  #reader{width:100%;height:260px;background:#000;border-radius:12px;margin-bottom:10px;}
  .status{padding:6px 10px;border-radius:8px;margin-bottom:8px;}
  .status.loading{background:#fff8c6;color:#9a6f00;}
  .status.success{background:#d4edda;color:#155724;}
  .status.error{background:#f8d7da;color:#721c24;}
</style>
</head>
<body>
<div class="card">
  <h1>SCC QR Scanner</h1>
  <label>Aksi:<br>
    <select id="action">
      <option>Picked Up</option>
      <option>Start Work</option>
      <option>Finish Work</option>
      <option>Delivered</option>
    </select>
  </label>
  <br>
  <button id="startBtn">Start Scanner</button>
  <button id="stopBtn" disabled>Stop Scanner</button>
  <div id="reader"></div>
  <div id="statusLine" class="status loading">Menunggu library...</div>
</div>

<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<script>
let scanner=null; let isScanning=false;
const statusEl = document.getElementById('statusLine');
const actionEl = document.getElementById('action');

function setStatus(msg,type='loading'){statusEl.textContent=msg;statusEl.className='status '+type;}

async function startScanner(){
  if(isScanning){setStatus('Scanner sudah berjalan','error'); return;}
  scanner = new Html5Qrcode("reader");
  try{
    await scanner.start({facingMode:"environment"},{fps:10,qrbox:250},
      async decodedText=>{
        setStatus('QR Terdeteksi: '+decodedText,'success');
        try{
          await fetch('https://script.google.com/macros/s/AKfycbyJvluaqqe3J_suB8RBWMptb51Iw7msr3R1KDB204w0XoBaZwlcahDZzJKaY90fiBcw/exec',{
            method:'POST',
            body:JSON.stringify({qr:decodedText,action:actionEl.value}),
            headers:{'Content-Type':'application/json'}
          });
        }catch(e){console.error(e);}
      },
      err=>{console.log(err);}
    );
    isScanning=true;
    setStatus('Scanner berjalan','success');
    document.getElementById('startBtn').disabled=true;
    document.getElementById('stopBtn').disabled=false;
  }catch(err){
    setStatus('Gagal start: '+err,'error');
  }
}

async function stopScanner(){
  if(scanner && isScanning){await scanner.stop();await scanner.clear();scanner=null;isScanning=false;}
  setStatus('Scanner dihentikan','loading');
  document.getElementById('startBtn').disabled=false;
  document.getElementById('stopBtn').disabled=true;
}

document.getElementById('startBtn').addEventListener('click',()=>startScanner());
document.getElementById('stopBtn').addEventListener('click',()=>stopScanner());
</script>
</body>
</html>